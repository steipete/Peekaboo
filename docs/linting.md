---
summary: 'Record the current lint situation and outline the refactor plan.'
read_when:
  - 'tackling lint regressions or prepping a refactor that crosses many files'
  - 'planning doc changes that need editor or playground upkeep'
---

# Linting & Formatting Roadmap

## Current status (November 12, 2025)

- SwiftLint run from the repo root (`swiftlint --config .swiftlint.yml`) emits ~760 warnings/errors spread across 616 Swift files. The biggest concentrations are huge CLI test suites (type_body_length/file_length), SwiftUI playground views (line_length/cyclomatic_complexity/multiple closures with trailing closures), and some helper/test utilities with force-casts/force-tries.
- Commander now obeys the lint rules—our new DocC work introduced no fresh violations. The remaining noise is entirely inside CLI + Playground targets that pre-date this change.
- Automating the fix must be surgical; the current solution will focus on the playground views first because the warning density there is lower and the necessary changes are localized (remove trailing-closure syntax, shorten long lines, drop stale suppressions).

## Short-term tasks (today)

1. **Document the refactor plan** (this file) so other agents/engineers know where to land the long-standing issues.
2. **Refactor Playground views** to use explicit `label:`/`action:` closures instead of only trailing closures and remove unused `swiftlint:disable` pragmas in `LogViewerWindow`.
3. **Shorten blatantly long view methods** (e.g., chunk `PlaygroundApp` / `ControlsView` if possible) and prepare follow-up issues for the CLI tests that exceed `function_body_length` or `file_length` thresholds.

## Mid/long-term plan (next wave)

- Break `CommanderBinderTests` and similarly oversized suites into smaller files/suites so they fall below `type_body_length`/`file_length` limits while keeping loops of helper functions grouped logically.
- Triage the remaining `function_body_length`/`cyclomatic_complexity` warnings in `PlaygroundApp` by extracting helpers and adopting `#warning` stubs for large but stable blocks; consider permalinks for complexity-critical sections.
- Work through the `force_cast`/`force_try` hotspots in test helpers by wrapping them in safe wrappers or using `XCTUnwrap` style assertions (preferring `fatalError` only when truly unreachable).
- Re-run SwiftLint with `--reporter json` after each batch and capture the residual warnings in a follow-up section of this doc.

## Communication

- Mention the lint count when you reopen CI runs; post-cleanup, future docs should reference this file to track progress.
- If any rule needs temporary relaxation, add it to `.swiftlint.yml` with a clear justification and document it here (use `read_when` to capture when to revisit).

## Activity log

- `2025-11-12`: Knocked the warning count down to **71** by trimming a dozen UI/service hotspots: wrapped the verbose permission/dock logs into helper strings, refactored `VisualizerSettingsView`’s preview switch into per-effect helpers, replaced the `try!` fallback in `PeekabooApp` with a guarded builder plus a new `AppStateConnectionContext`, moved Unified Activity Feed’s markdown parsing into a safe accessor, removed the lingering `enumerated` loops in the visualizer overlays, tightened `AIPropertyWrapper`’s streaming loop with guards, added attributed-title helpers to `SessionTitleGenerator`, and logged the Visualizer event errors with shorter line-length-safe builders.
- `2025-11-12`: Cleared another batch (now **62** warnings) by: removing the redundant optional initializer in `CommandRuntimeOptions`, splitting AX observer creation into helpers (fixing `function_body_length` in `AXObserverManager` plus multiple long log strings across AXCore), wrapping the remaining AX line-length offenders (`DataModels`, `MatchingTypes`, `NotificationWatcher`, `Scannable`, `AXTrustUtil`), eliminating `force_try` from the Peekaboo agent + realtime voice test suites, and polishing the menu/visualizer UI helpers (Menu/Hotkey animations, Visualizer Settings preview, Unified Activity Feed markdown fallback).
- `2025-11-12`: Dropped the count to **59** by extracting dedicated helpers for the ghost icon render loop (`MenuBarAnimationController`) and menu icon drawing (`GhostMenuIcon`), splitting `AttributeValue.init(from:)` and `convertCFValueToSwift` into small reusable helpers to satisfy cyclomatic rules, tightening the remaining AX log strings, and replacing every lingering `try!` in the agent/realtime voice tests with throwing helpers so the test targets honor the lint rules.
- `2025-11-12`: Count dropped to **51** after shortening automation logging (`PeekabooServices.executeAutomationActions`), finishing the AX log cleanup (`VisualizerEventReceiver`), removing force casts in UI automation focus lookup, and fixing the MCP multi-content test’s string-data conversion.
- `2025-11-12`: Down to **50** warnings by splitting `MenuDetailedMessageRow` into dedicated header/content/tool subviews, extracting the Add Custom Provider wizard steps into reusable view structs, and fixing the remaining picker line lengths so both UI files now satisfy `type_body_length` and formatting rules.
- `2025-11-12`: Reduced to **45** warnings by wrapping the remaining long MCP schema strings (`type`, `move`, `scroll`, `sleep`, `menu` tools) plus ScrollService logging, which tidied five `line_length` hits in a single sweep while keeping the docs the same.
- `2025-11-12`: Rebuilt `GestureService` swipe/drag helpers with `GesturePathContext`, event/posting utilities, and shared validation/log formatting so `swipe` now delegates to `performSwipe`, `drag` to `executeDrag`, and the missing helper definitions (`describeGesture`, `ensurePositiveSteps`, `stepDelay`, etc.) are centralized—clearing the final `function_body_length` warning for that file and dropping the global count to 128.
- `2025-11-12`: Converted `TypeService`’s massive special-key switch into a `SpecialKeyMapping` dictionary with whitespace-normalized lookups so `mapSpecialKeyToVirtualCode` is a one-liner, eliminating both the `function_body_length` and `cyclomatic_complexity` warnings for that helper and bringing the total warning count down to 126.
- `2025-11-12`: Wrapped the verbose Visualizer storage/migration log strings in multi-line literals so `VisualizerEventStore` no longer exceeds the `line_length` cap when we print cleanup removals or app-group paths, trimming two warnings and landing the overall count at 124.
- `2025-11-12`: Converted `ScrollService` to consume `ScrollRequest`, extracting helpers for target resolution, tick posting, and timing (plus a `ScrollExecutionContext` struct) so the top-level `scroll` entry point now meets both the parameter-count and function-body limits; SwiftLint now reports 122 warnings.
- `2025-11-12`: Replaced `HotkeyService`'s 100-branch `mapKeyToVirtualCode` switch with a `HotkeyKeyMapping` dictionary and reuse helper, trimming the cyclomatic complexity and function-length offenders in one go and lowering the total warning count to 120.
- `2025-11-12`: Broke `ApplicationToolFormatter`’s `listApps`/`listWindows` formatters into helper summaries (state/category/memory + window states/titles) so each formatter is now just a dispatcher, erasing both `function_body_length` warnings and dropping the total to 118.
- `2025-11-12`: Wrapped the long-see/click discussion strings in `ToolDefinitions` with multi-line literals, clearing the last `line_length` hits inside the registry file and nudging the warning total down to 116.
- `2025-11-12`: Broke the two long SessionManager log strings (screenshot-copy failure + valid-session discovery) into multi-line builds, eliminating the lingering `line_length` warnings and dropping the repo total to 114.
- `2025-11-12`: Wrapped the Hotkey MCP tool’s schema description and success log message so both lines stay under 120 chars, clearing that tool’s pair of `line_length` hits and bringing the global warning count to 112.
- `2025-11-12`: Refactored the Swipe MCP tool so `execute` now delegates to `performSwipe` + `buildResponse`, and the huge single-line status string is a multiline literal; this clears its function-length + 300-char warning pair, dropping the repo total to 110.
- `2025-11-12`: Updated AgentToolDescriptionTests to use `for … where` clauses and direct filters, eliminating the `for_where` warnings and moving the overall lint count down to 108.
- `2025-11-12`: Swapped MCP client config tests to use `is [String: Any]` checks instead of `as? … != nil`, removing those prefer_type_checking warnings and bringing the repo total to 106.
- `2025-11-12`: Refined `convertMCPSchemaToAgentSchema` into helper routines and removed the `try!` inside `ToolArguments.init`, clearing both the function-length and force_try warnings in `PeekabooAgentService+Tools` and lowering the overall count to 104.
- `2025-11-12`: Wrapped MCP Agent tool descriptions/schemas to satisfy the line-length rule, trimming two more hits and taking the total warning count to 102.
- `2025-11-12`: Split ValueParser’s CFType conversion helpers (plus the AX value parsing dispatcher) into focused functions and multiline strings, removing the `function_body_length` + `line_length` warnings and dropping the tally to 100.
- `2025-11-12`: Refactored the TextExtraction helper to use attribute/child text collectors + logging helpers, eliminating its `function_body_length`/`cyclomatic_complexity` warnings and bringing the overall count to 98.
- `2025-11-12`: Pulled the TextEdit-based AXorcist tests into helper routines (`withFreshTextEdit`, `setText`, `runQuery`, etc.), cutting both test functions under the limit and reducing warnings to 96.
- `2025-11-12`: Broke the gigantic TextEdit setup helper into focused pieces (launch/wait, window creation, logging) to remove its function-length/complexity hit, keeping the overall warning count at 94.
- `2025-11-12`: Refactored AttributeExtractors to dispatch through `AttributeDirectMapping` + `AttributeDefaultSet`, cutting the switch-based cyclomatic-complexity warning while maintaining behavior.
- `2025-11-12`: Wrapped the DOM class matcher logic in `DOMClassMatcher` so the handler remains readable and the cyclomatic-complexity violation is gone; total warnings now sit at 91.
- `2025-11-12`: Replaced the dual window-screen loops with `first(where:)` lookups so `Element+WindowOperations.swift` no longer trips the `for_where` rule; warning count remains 91.
- `2025-11-12`: Shortened the focused-element handler logs and error strings so the two `line_length` warnings disappeared in `AXorcist+FocusedElementHandler.swift` (still 91 warnings overall).
- `2025-11-12`: Split the AX batch dispatcher into smaller helpers (`processQueryAndActionCommands`, etc.) and shortened the error logging so both `cyclomatic_complexity` + `line_length` hits were eliminated in `AXorcist+BatchHandler.swift` (warnings still 91).
- `2025-11-12`: Broke `AXorcist+ActionHandlers` into reusable helpers (element lookup, action validation, focus prep) so `handlePerformAction` and `handleSetFocusedValue` both fall under the function-length rule; total warnings remain 91.
- `2025-11-12`: Wrapped the DOM class criterion in `DOMClassMatcher` so the handler no longer violates the complexity rule; total warnings remain 93.
- `2025-11-12`: Extracted DOM class matching logic into `DOMClassMatcher` so the criterion handler is now a concise dispatcher; coupled with the ValueParser/TextEdit helpers the repo sits at 93 warnings.

- `2025-11-12`: Rewrote `SingleCriterionMatching.swift` with a `CriterionContext` helper plus `logSegments`-based logging so the matcher switch fits under the `function_body_length` limit and every diagnostic string stays below 120 characters, dropping 12 warnings and bringing the running count to 159.
- `2025-11-12`: Split `PeekabooSettings` into a lean base type plus an extension, decomposed `load()` into targeted helpers (`loadProviderSettings`, `loadUIPreferences`, `loadVisualizerSettings`, `loadAnimationPreferences`, `loadRealtimeVoiceSettings`), and introduced shared utilities for namespaced UserDefaults keys so the `type_body_length`, `function_body_length`, and `line_length` hits disappeared; SwiftLint now reports 156 warnings.
- `2025-11-12`: Refactored `ClickTool` into a parsed `ClickRequest`, target resolver, and response builder—replacing the 100+ line `execute` body and wrapping long schema descriptions—so its `function_body_length` and `line_length` warnings are gone.
- `2025-11-12`: Broke `ImageTool` into an `ImageRequest` parser plus capture/save/analysis helpers, wrapped the long description text, and swapped the window enumeration to `indices`, removing the giant `execute` body, the 430-character description line, and the `unused_enumerated` warning.
- `2025-11-12`: Reworked `DragTool` with `DragRequest`, `DragLocationInput`, and response/focus helpers so the drag logic now fits under the function/body limits, the long space-management log is wrapped, and the tool reports richer metadata without any lint warnings.
- `2025-11-12`: Split `SeeTool` into `SeeRequest`, screenshot/annotation helpers, and metadata builders while wrapping the long schema descriptions; `execute` is now a dispatcher and `detectUIElements` delegates to window-context/element conversion helpers so the function-length warnings disappeared and the overall SwiftLint count dropped to 144.
- `2025-11-12`: Added `ScrollRequest`, converted every automation/CLI call site to the typed request, moved `UIAutomationService` behavior into extensions, and rewrote `waitForElement` with helper lookups plus safe AX element casting so the class/type/function length and force_cast warnings disappeared without suppressions.
- `2025-11-12`: Carved `PeekabooAgent` into a lean core plus a private @MainActor extension, added targeted event-handling helpers, and wrapped the long tool-duration string so the class/type/function length warnings are gone; SwiftLint now reports 137 warnings.
- `2025-11-12`: Trimmed `WindowManagementService` by moving the public API into an `@MainActor` extension, introducing `WindowSearchContext`, helper accessors for app/window lookups, and wrapping the long focus error so both the type/body length and function-parameter-count warnings disappeared.
- `2025-11-12`: Converted the end-to-end integration suites to use throwing `setup()` helpers rather than `try!`, updated the tests to be `async throws`, and removed the remaining `force_try` calls so those force-unwrap warnings vanished.
- `2025-11-12`: Split `PeekabooAgentService` into targeted extensions (`+Streaming`, `+Sessions`) so the streaming loop/tool execution helpers and session lifecycle utilities live outside the core file,
  added a reusable audio dry-run builder, and cleared the lingering `file_length`, `function_body_length`, and `function_parameter_count` warnings for the agent service trio of files.
- `2025-11-12`: Shortened every AXUtilities log string and signature so that helper now respects the `line_length` limit (11 warnings removed) while keeping the same logging detail and behavior.
- `2025-11-12`: Reformatted the macOS Settings window (provider detection helper, multiline slider/text field arguments, wrapped long-copy strings) to eliminate the `line_length`, `for_where`, and `multiline_arguments` violations in that SwiftUI form.
- `2025-11-12`: Broke the ToolRegistry documentation strings into shorter lines and wrapped the CLI guidance text, clearing eight `line_length` warnings without changing any rendered guidance.
- `2025-11-12`: Cleaned the AXorcist ping integration suite by extracting shared failure messages so every expectation stays within the `line_length` budget.
- `2025-11-12`: Removed redundant raw-value declarations and reformatted long signatures inside `Element+UIAutomation` so the mouse/scroll helpers lint clean.
- `2025-11-12`: Refactored `matchArrayAttribute` plus the boolean/computed-name logging in `SpecificAttributeMatchers` into helper routines, trimming the hot `function_body_length` path and fixing the lingering `multiline_arguments` warnings.
- `2025-11-12`: Split `DialogService` into public/private extensions, added text-entry/file-dialog helpers, and centralized the key map so the class now passes `type_body_length`, `function_body_length`, and `line_length` without reducing functionality.
- `2025-11-12`: Broke `ProcessService` into public/private extensions, added screenshot/window/menu parameter helpers, and decomposed the swipe/window normalization logic so `ProcessService.swift` now clears `type_body_length`, `function_body_length`, `cyclomatic_complexity`, and `unused_optional_binding`.
- `2025-11-12`: Refactored `AXorcist` query integration tests to use shared helpers (`withTextEdit`, `executeCommand`, assertion utilities), trimming each test below the `function_body_length` budget and removing the remaining long-line violations.
- `2025-11-12`: Cleaned AXorcist path navigation helpers by extracting structured logging/visitor helpers in `PathNavigationUtilities` plus the matching layer (`PathNavigationMatching`, `AttributeMatchingFunctions`), eliminating 32 warnings covering `function_body_length`, `line_length`, `multiline_arguments`, and `function_parameter_count` without changing behavior.
- `2025-11-12`: Refactored the MCP `WindowTool` to parse `WindowAction` enums, validate coordinates via helper structs, shorten success messages, and reuse `WindowTarget`-based handlers which removed 12 warnings (function length, parameter count, and long lines) from `WindowTool.swift`.
- `2025-11-12`: Broke `ConfigurationManager` into reusable helpers (`JSONCommentStripper`, `ConfigurationDefaults`, action extensions), eliminated force casts in the precedence resolver, shortened the JSONC/comment stripping and default-config builders, and moved the huge custom-provider block into extensions so the file now lint-checks clean (type/function body length, line length, and force_cast all resolved).
- `2025-11-12`: Simplified `DialogTool` by introducing `DialogAction`/`DialogInputs`, extracted list-formatting and success-response helpers, and trimmed the action handlers so the file is free of `function_body_length`, `function_parameter_count`, and `line_length` warnings.
- `2025-11-12`: Rebuilt `ListTool` with typed `ListRequest`/`WindowDetail` parsing, formatter structs for running-app and window summaries, and shorter schema docs, clearing every long-line warning (including the >250-char schema text) and future-proofing the server-status section.
- `2025-11-12`: Split `ApplicationService` into lightweight @MainActor extensions with a dedicated `WindowEnumerationContext` plus a Spotlight search helper so `listWindows` delegates to smaller helpers; this cleared the `type_body_length`, `function_body_length`, `cyclomatic_complexity`, `for_where`, `line_length`, and `multiline_arguments` warnings for that service.

- `2025-11-12`: Documented the lint roadmap, refactored the Playground views (`ContentView`, `LogViewerWindow`, `TextInputView`) to stop using trailing-closure syntax when multiple blocks are supplied, and removed stale `swiftlint:disable` comments so those files pass linting.
- `2025-11-12`: Swapped the expand buttons in `AgentActivityView`, `ElementDetailsView`, and `AllElementsView` to explicit `label:` closures so the `multiple_closures_with_trailing_closure` warnings are gone for those helpers.
- `2025-11-12`: Reworked the voice/text input buttons in `StatusBarInputView`, including the voice toggle, submit, realtime recording controls, StatusBar action buttons, metadata/expand controls, and the session sidebar header/search buttons so every StatusBar/control component now supplies `label:` closures and obeys the trailing-closure rule.
- `2025-11-12`: Patched the Session Chat input areas so every button (cancel, submit, mode swap, recording) now uses explicit `label:` closures, further reducing the trailing-closure violations in the message UI.
- `2025-11-12`: Updated the detailed message row to use explicit `label:` closures for the Retry/expand controls, ensuring the rich message UI also stays clean.
- `2025-11-12`: Converted the App Selector's per-application buttons inside the detail menu to the `label:` form, knocking another source of trailing-closure warnings in the UI component library.
- `2025-11-12`: Converted the Main Window session popover close button to the explicit `label:` form so even the session list controls comply with the trailing-closure rule.
- `2025-11-12`: Made the Enhanced Session Detail configuration button explicit so its action no longer relies on trailing-closure syntax.
- `2025-11-12`: Updated the Visualizer test automation buttons so their async animation triggers now supply explicit `label:` closures, keeping the visualization helpers lint-clean.
- `2025-11-12`: Adjusted the Image Inspector zoom controls so their buttons now supply `label:` closures, keeping the accessory view lint-clean.
- `2025-11-12`: Replaced the forced `SpeechError` cast in `MainWindow` with optional binding so the error-handling path no longer hits the `force_cast` rule.
- `2025-11-12`: Converted the Main Window session popover close button to the explicit `label:` form so even the session list controls comply with the trailing-closure rule.
- `2025-11-12`: Converted the Enhanced Session Detail tabs to explicit `label:` closures so the top-level controls no longer trip the trailing-closure rule.
- `2025-11-12`: Patched the Session Chat toolbar and expanded tool call components so their toolbar disclosure and image buttons now use `label:` closures, keeping the message and tool-call UIs tidy.
- `2025-11-12`: Patched the status bar unified feed expand buttons, ensuring the collapsible message controls obey the trailing-closure rule as well.
- `2025-11-12`: Replaced the trailing closure call to `NSAnimationContext.runAnimationGroup` with its `completionHandler:` parameter to remove the last `multiple_closures_with_trailing_closure` hit in the animation overlay manager.
- `2025-11-12`: Refactored `PlaygroundApp` so click/key logging now uses helper functions and dictionary lookups, eliminating the long line/cyclomatic-complexity warnings while keeping the event logging logic intact.
- `2025-11-12`: Shortened a long JSON fixture in `SessionTests` by moving the literal into a multi-line string so the line stays under 120 characters and the line-length rule is satisfied.
- `2025-11-12`: Converted the Tool Execution History expand control to the `label:` form so the history list complies with the trailing-closure rule.
- `2025-11-12`: Updated the detailed message row to use explicit `label:` closures for the Retry/expand controls, ensuring the rich message UI also stays clean.
- `2025-11-12`: Converted the App Selector's per-application buttons inside the detail menu to the `label:` form, knocking another source of trailing-closure warnings in the UI component library.
- `2025-11-12`: Adjusted the Realtime session UI so the toolbar buttons use explicit `label:` closures (gear, keyboard, recording, etc.) and the expand/detail image buttons now follow the same pattern, erasing the final trailing-closure hits from that view.
- `2025-11-12`: Updated the status bar menu and expanded tool call components so their disclosure and image buttons also use `label:` closures and no longer trip the trailing-closure rule.
- `2025-11-12`: Converted the expanded tool call buttons to the `label:` form so tool inspection also plays nicely with the trailing-closure rule.
- `2025-11-12`: Updated the detailed message row to use explicit `label:` closures for the Retry/expand controls, ensuring the rich message UI also stays clean.
- `2025-11-12`: Patched `RealtimeConversationView` so every button supplying both `action` and a closure now uses the `label:` form, clearing the remaining trailing-closure warnings in the Tachikoma realtime UI.
- `2025-11-12`: Converted the session/delete/open buttons in `SessionComponents` so they also provide `label:` closures, brushing another small corner of the trailing-closure backlog.
- `2025-11-12`: Reworded the `SessionStore` documentation comment into multiple lines so it now satisfies the line-length rule without losing detail.
- `2025-11-12`: Simplified `PlaygroundApp`'s global click monitor by extracting descriptor helpers and early-returning when there is no window hit so the closure now stays below the cyclomatic-complexity limit.
- `2025-11-12`: Broke the drag completion details in `DragDropView` into structured pieces so the logging line is shorter and the `line_length` warning disappears.
- `2025-11-12`: Shortened the `currentCommit` extraction in `BuildStalenessChecker` and rewrote the modified-file loop with a `for ... where` clause so both the `line_length` and `for_where` warnings are resolved.
- `2025-11-12`: Split the config file/credentials print strings and broke the provider hint into two lines so `ConfigCommand` now obeys the `line_length` budget for those sections.
- `2025-11-12`: Reworked `AgentOutputDelegate`'s success/error logging helpers so each status line is composed of small segments, eliminating the `line_length` hits while keeping the verbose/helpful output and preserving the newly introduced helper APIs.
- `2025-11-12`: Shortened the `ListCommand` menu-bar frame print by precomputing the origin/size strings so the line now stays within 120 characters.
- `2025-11-12`: Extracted a helper to print each menu-bar item so `ListCommand.printMenuBarItems` now fits within the `function_body_length` limit.
- `2025-11-12`: Split `ScreensSubcommand.run` by delegating construction of list data, summary, metadata, and plain-text output to helpers so the core run method now complies with `function_body_length` while keeping the same response.
- `2025-11-12`: Refactored `AgentOutputDelegate.handleToolCallStarted` into a dedicated printer helper (and moved the entire delegate implementation into a private extension) so the type body shrank below 400 lines while keeping the same terminal output and flow for communication tools.
- `2025-11-12`: Simplified `SeeCommand` logging/output strings by building the verbose detail line from short segments and by adding a reusable screen-display helper so the CLI output lines now obey the `line_length` rule.
- `2025-11-12`: Shortened every overlong `AgentCommand` prompt/notification (header banner, error/resume hints, terminal capabilities debug, session lists) and added a `printCapabilityFlag` helper so the file now satisfies `line_length` without changing the colored CLI experience.
- `2025-11-12`: Refactored `AgentCommand.runInternal` into helper-driven stages (logging/MCP setup, resume handling, task construction), consolidated the session list printer into smaller helpers, and encapsulated the audio workflow so the helper functions share consistent logging and the primary method stays within the body/complexity limits.
- `2025-11-12`: Split the AXObserverCenter logging strings into joined segments via `logSegments`/`describePid` so each message stays under 120 characters yet retains the caller, PID, and notification context.
- `2025-11-12`: Slimmed `AXORCMain` usage/help strings and observe-run logging by building them from smaller pieces, keeping the CLI hints readable while satisfying `line_length`.
- `2025-11-12`: Shortened the Playground controls date-change log string, removed unused `swiftlint:disable` pragmas in `ImageCaptureLogicTests`, updated the Menu helper closures to `-> Void`, and refactored `SeeCommandAnnotationTests.enhancedDetectionWindowContext` into helper-driven helpers so the function now fits the `function_body_length` budget.
- `2025-11-12`: Pulled the Playground click monitor logic into `handleGlobalMouseClick`, broke the screen-coordinate math into separate variables, and simplified the logger setup so the `line_length` and `cyclomatic_complexity` warnings in `PlaygroundApp.swift` no longer occur.
- `2025-11-12`: Trimmed `SpaceCommandReadTests.makeTestContext` by moving the static test fixtures (applications, windows, spaces) into helpers so the main helper now fits within the `function_body_length` limit without changing any test behavior.
- `2025-11-12`: Removed redundant `swiftlint:disable` directives in `ListCommandTests.swift` and switched the automation helper closures to `-> Void` across `AppCommandTests`, `DragCommandTests`, `SwipeCommandTests`, `PressCommandTests`, `ScrollCommandTests`, and `MoveCommandTests` to eliminate the lingering `superfluous_disable_command` and `void_return` warnings.
- `2025-11-12`: Replaced the force-cast JSON parsing in `ConfigurationTests` with a helper that safely validates the decoded object (`decodedDictionary(from:)`) and added a small error enum so the tests no longer trigger the `force_cast` rule.
- `2025-11-12`: Extracted the heavy `SeeCommandRuntimeTests.seeCommandStoresScreenshot` setup into a `RuntimeFixture` helper so the runtime test body now sits below the `function_body_length` limit without changing the scenario or assertions.
- `2025-11-12`: Delegated the `AppCommandTests` fixtures (applications/windows) to helper helpers so `defaultAppCommandData` only wires them together, trimming the function below the `function_body_length` threshold while keeping the stub data intact.
- `2025-11-12`: Pulled the `AllCommandsJSONOutputTests` `allCommands` list into a shared static constant so `verifyAllCommandsHaveJSONOutputFlag` now just iterates the prebuilt list, cutting the function body beneath 50 lines.
- `2025-11-12`: Wrapped `DialogCommandTests.runCommand(_:services:)` across multiple lines so the helper signature now satisfies the `line_length` rule.
- `2025-11-12`: Updated `ImageAnalyzeIntegrationTests.emptyAnalyzePrompt` to assert `command.analyze.isEmpty` instead of comparing to `""`, removing the `empty_string` violation.
- `2025-11-12`: Added a `swiftlint:disable:next function_parameter_count` for `StubAutomationService.scroll` in `Support/TestServices.swift` since the method mirrors the automation API and legitimately requires six parameters.
- `2025-11-12`: Split `CommanderBinderTests.swift` into three targeted suites (runtime options, command binding, and program resolution) so each file/type now stays under the `file_length`/`type_body_length` thresholds while keeping the original assertions intact.
- `2025-11-12`: Rebuilt the `AgentResumeCLITests.resumePromptIsConstructedCorrectly` strings using a joined array to keep the `line_length` checks happy while still testing the long continuation prompt.
- `2025-11-12`: Switched `AgentMenuTests`’ menu discovery loop to `for ... where` so the inner filtering now satisfies `for_where` without losing any of the JSON parsing logic.
- `2025-11-12`: Refactored the intensive `SeeCommandAnnotationIntegrationTests` flows to call shared capture/cleanup helpers (`runSeeCommand`, `annotatedPath`, `cleanupScreenshots`, `fileSize`) and moved the sample `DetectedElements` builder outside the test, eliminating the remaining `function_body_length` hits while keeping the integration coverage intact.
- `2025-11-12`: Rebuilt `AppTool.swift` around an `AppToolRequest` + `AppToolActions` dispatcher so each action handler (launch/quit/relaunch/focus/hide/unhide/list) is short and the parent struct no longer violates the `type_body_length`, `function_body_length`, or `line_length` rules.
- `2025-11-12`: Wrapped every AX application action log string (`activate`, `hideApplication`, `unhideApplication`) with joined segments so `Element+ApplicationActions.swift` no longer triggers `line_length` warnings while keeping the exact diagnostics.
- `2025-11-12`: Added `processDebugLog`/`processWarningLog` helpers in `ProcessUtils`, converted every call site to the new helpers, and refreshed the pid finder utilities so the `function_body_length` and `multiline_arguments` warnings disappear without altering any process lookup logic.
- `2025-11-12`: Introduced a local `logQuery` helper in `AXorcist+QueryHandlers`, rewrote all info/debug/error messages to use joined segments, and reformatted the helper method signatures so every `line_length` and `multiline_parameters` warning in that file is gone (bringing the global SwiftLint total down to 301).
- `2025-11-12`: Split `PeekabooServices.createShared()` into `buildServiceDependencies`/`resolveAgentIfAvailable`, reworked the automation pipeline with `prepareAutomationSession` + `executeAutomationActions`, and bundled the model-selection inputs into `ModelSources` so `function_body_length`, `function_parameter_count`, and the three long-line violations vanished (SwiftLint total now 295).
- `2025-11-12`: Converted `CommandExecutor.processCommand` into dictionary-driven handlers (`simpleExecutors`, `commandHandlers`, `notImplementedCommands`), fixed the mid-line parameter formatting, and wrapped the long debug strings so all six lint warnings dropped (SwiftLint total now 290).
- `2025-11-12`: Refactored `Element+ComputedName` to iterate over structured prompt candidates, centralized logging (`logComputedName`/`logMissingComputedName`), and capped the re-used strings in `AIAssistantWindow` via `AIAssistantPrompts`, removing five `line_length` hits there and bringing the overall warning count down to 280.
- `2025-11-12`: Split `VisualizerCoordinator` into a slim core class plus `extension` blocks for animation APIs and display helpers, wrapped the long log strings, and cleared the `type_body_length` + `line_length` warnings alongside the remaining UI log issues (SwiftLint total now 275).
- `2025-11-12`: Added a shared `visualizerLogMessage` helper in `VisualizerEventReceiver`, rewrote the long log/error strings, and reformatted the dialog animation call to bring the entire file under the 120-character limit (SwiftLint total now 270).
- `2025-11-12`: Broke `AXorcist+ObservationHandler` into helpers (`logObservationStart`, `startObservation`, `makeObservationCallback`) so `handleObserve` sits below 50 lines and every log string is composed from short segments (SwiftLint total now 265).
- `2025-11-12`: Wrapped AnalyzeTool's description/schema strings into shorter lines and factored the timing message into joined components, clearing all five `line_length` warnings there (SwiftLint total now 260).
- `2025-11-12`: Refactored ElementToolFormatter compact summaries into helper methods and split the find/list/focused result formatters into smaller helpers, eliminating the cyclomatic-complexity warnings there, while SeeTool and SpaceTool now wrap their descriptions/schemas and delegate work through helper pipelines so all remaining MCP tool warnings cleared (SwiftLint total 255).
- `2025-11-12`: Modernized `GlobalAXLogger`, rebuilt `ElementDetectionService` around reusable application/window resolution + traversal helpers, split `MenuService` core logic into an extension with collector helpers, and tightened `SpaceTool`, `WindowManagementService`, `MenuCommand`, and both `AcceleratedTextDetector` variants; these batches trimmed the repo warning count from 251 → 217, tackling `function_body_length`, `function_parameter_count`, `type_body_length`, `line_length`, and `multiline_arguments` across AX logging, MCP tools, UI services, and CLI glue code.
- `2025-11-12`: Carved the MCP interaction tools into request/handler helpers (`TypeTool`, `ScrollTool`, `MoveTool`), wrapped Dock/Permissions descriptions, tightened ScreenCaptureService window-index errors, and shortened AX logging strings; SwiftLint now reports 187 warnings (down from 217) with the remaining hotspots centered on the agent prompt builders and legacy AX handlers.
- `2025-11-12`: Refined the agent-side tooling (`MCPAgentTool`, `AgentSystemPrompt`) plus the AX point lookup handler: agent commands now split parsing/listing/formatting helpers, GPT-5 preamble text is modularized, and `GetElementAtPoint` logging moved into short utilities. SwiftLint is down to 177 warnings, mostly in legacy AX property dumps and PeekabooAgent complexity hotspots.
- `2025-11-12`: Broke the AX property dump/command factories into small builders (`AXPropertyDumpBuilder`, CommandType builder map), shortened ValueUnwrapper logging, and split PeekabooAgent’s giant `executeTaskInternal` into prep/run/persist helper methods. Latest SwiftLint run shows 164 warnings, with the remaining work in legacy AX searches, See/Click/Image tool formatting, and the macOS Settings UI tests.
- `2025-11-12`: Cleaned the remaining type-erased/logging helpers—AnyCodable now compares via helpers, AX path/logger strings are wrapped, and the attribute extractor lives inside `AttributesCollector`/`AttributeFormatter`. Fresh `swiftlint lint` reports 163 warnings concentrated in AX search filters and a handful of CLI/UI files.
