import Foundation

/// Root configuration structure for Peekaboo settings.
/// Test comment for Poltergeist
///
/// This structure represents the complete configuration file format (JSONC) that can be
/// stored at `~/.peekaboo/config.json`. All properties are optional, allowing
/// partial configuration with fallback to environment variables or defaults.
public struct Configuration: Codable {
    public var aiProviders: AIProviderConfig?
    public var defaults: DefaultsConfig?
    public var logging: LoggingConfig?
    public var agent: AgentConfig?
    public var visualizer: VisualizerConfig?

    public init(
        aiProviders: AIProviderConfig? = nil,
        defaults: DefaultsConfig? = nil,
        logging: LoggingConfig? = nil,
        agent: AgentConfig? = nil,
        visualizer: VisualizerConfig? = nil)
    {
        self.aiProviders = aiProviders
        self.defaults = defaults
        self.logging = logging
        self.agent = agent
        self.visualizer = visualizer
    }

    /// Configuration for AI vision providers.
    ///
    /// Defines which AI providers to use for image analysis, their API keys,
    /// and connection settings. Supports both cloud-based (OpenAI) and local (Ollama) providers.
    public struct AIProviderConfig: Codable {
        public var providers: String?
        public var openaiApiKey: String?
        public var anthropicApiKey: String?
        public var ollamaBaseUrl: String?

        public init(
            providers: String? = nil,
            openaiApiKey: String? = nil,
            anthropicApiKey: String? = nil,
            ollamaBaseUrl: String? = nil)
        {
            self.providers = providers
            self.openaiApiKey = openaiApiKey
            self.anthropicApiKey = anthropicApiKey
            self.ollamaBaseUrl = ollamaBaseUrl
        }
    }

    /// Default settings for screenshot capture operations.
    ///
    /// These settings apply when no command-line arguments are provided,
    /// allowing users to customize their preferred capture behavior.
    public struct DefaultsConfig: Codable {
        public var savePath: String?
        public var imageFormat: String?
        public var captureMode: String?
        public var captureFocus: String?

        public init(
            savePath: String? = nil,
            imageFormat: String? = nil,
            captureMode: String? = nil,
            captureFocus: String? = nil)
        {
            self.savePath = savePath
            self.imageFormat = imageFormat
            self.captureMode = captureMode
            self.captureFocus = captureFocus
        }
    }

    /// Logging configuration for debugging and troubleshooting.
    ///
    /// Controls the verbosity and location of log files generated by Peekaboo
    /// during operation.
    public struct LoggingConfig: Codable {
        public var level: String?
        public var path: String?

        public init(level: String? = nil, path: String? = nil) {
            self.level = level
            self.path = path
        }
    }

    /// Agent configuration for AI-powered automation.
    ///
    /// Controls default settings for the Peekaboo agent, including the AI model
    /// to use and behavior options.
    public struct AgentConfig: Codable {
        public var defaultModel: String?
        public var maxSteps: Int?
        public var showThoughts: Bool?
        public var temperature: Double?
        public var maxTokens: Int?

        public init(
            defaultModel: String? = nil,
            maxSteps: Int? = nil,
            showThoughts: Bool? = nil,
            temperature: Double? = nil,
            maxTokens: Int? = nil)
        {
            self.defaultModel = defaultModel
            self.maxSteps = maxSteps
            self.showThoughts = showThoughts
            self.temperature = temperature
            self.maxTokens = maxTokens
        }
    }
    
    /// Visualizer configuration for animation and visual feedback.
    ///
    /// Controls visual feedback settings for UI automation operations,
    /// including animations, effects, and individual feature toggles.
    public struct VisualizerConfig: Codable {
        public var enabled: Bool?
        public var animationSpeed: Double?
        public var effectIntensity: Double?
        public var soundEnabled: Bool?
        public var keyboardTheme: String?
        
        // Individual animation toggles
        public var screenshotFlashEnabled: Bool?
        public var clickAnimationEnabled: Bool?
        public var typeAnimationEnabled: Bool?
        public var scrollAnimationEnabled: Bool?
        public var mouseTrailEnabled: Bool?
        public var swipePathEnabled: Bool?
        public var hotkeyOverlayEnabled: Bool?
        public var appLifecycleEnabled: Bool?
        public var windowOperationEnabled: Bool?
        public var menuNavigationEnabled: Bool?
        public var dialogInteractionEnabled: Bool?
        public var spaceTransitionEnabled: Bool?
        public var ghostEasterEggEnabled: Bool?
        
        public init(
            enabled: Bool? = nil,
            animationSpeed: Double? = nil,
            effectIntensity: Double? = nil,
            soundEnabled: Bool? = nil,
            keyboardTheme: String? = nil,
            screenshotFlashEnabled: Bool? = nil,
            clickAnimationEnabled: Bool? = nil,
            typeAnimationEnabled: Bool? = nil,
            scrollAnimationEnabled: Bool? = nil,
            mouseTrailEnabled: Bool? = nil,
            swipePathEnabled: Bool? = nil,
            hotkeyOverlayEnabled: Bool? = nil,
            appLifecycleEnabled: Bool? = nil,
            windowOperationEnabled: Bool? = nil,
            menuNavigationEnabled: Bool? = nil,
            dialogInteractionEnabled: Bool? = nil,
            spaceTransitionEnabled: Bool? = nil,
            ghostEasterEggEnabled: Bool? = nil)
        {
            self.enabled = enabled
            self.animationSpeed = animationSpeed
            self.effectIntensity = effectIntensity
            self.soundEnabled = soundEnabled
            self.keyboardTheme = keyboardTheme
            self.screenshotFlashEnabled = screenshotFlashEnabled
            self.clickAnimationEnabled = clickAnimationEnabled
            self.typeAnimationEnabled = typeAnimationEnabled
            self.scrollAnimationEnabled = scrollAnimationEnabled
            self.mouseTrailEnabled = mouseTrailEnabled
            self.swipePathEnabled = swipePathEnabled
            self.hotkeyOverlayEnabled = hotkeyOverlayEnabled
            self.appLifecycleEnabled = appLifecycleEnabled
            self.windowOperationEnabled = windowOperationEnabled
            self.menuNavigationEnabled = menuNavigationEnabled
            self.dialogInteractionEnabled = dialogInteractionEnabled
            self.spaceTransitionEnabled = spaceTransitionEnabled
            self.ghostEasterEggEnabled = ghostEasterEggEnabled
        }
    }
}
